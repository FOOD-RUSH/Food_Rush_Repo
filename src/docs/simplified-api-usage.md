# Simplified API Usage Guide\n\n## Overview\n\nThe API system has been simplified to provide a clean, production-ready solution with proper error handling and user-friendly messages.\n\n## Key Components\n\n### 1. API Client (`src/services/shared/apiClient.ts`)\n- Clean, minimal setup\n- Automatic token management\n- Built-in error handling\n- Android emulator support\n\n### 2. Error Handler (`src/utils/errorHandler.ts`)\n- User-friendly error messages\n- Multi-language support\n- Production-safe (no sensitive data exposure)\n- Development vs production modes\n\n### 3. Error Display Component (`src/components/common/ErrorDisplay.tsx`)\n- Ready-to-use error UI\n- Handles different error types\n- Retry and login actions\n\n### 4. API Hook (`src/hooks/shared/useApiCall.ts`)\n- Simplified API call management\n- Built-in loading states\n- Automatic error handling\n- Toast notifications\n\n## Usage Examples\n\n### Basic API Call with Hook\n\n```typescript\nimport { useApiCall } from '@/src/hooks/shared/useApiCall';\nimport { restaurantApi } from '@/src/services/customer/restaurant.service';\n\nconst RestaurantList = () => {\n  const { data, loading, error, execute } = useApiCall(\n    restaurantApi.getAllRestaurants,\n    { context: 'RestaurantList' }\n  );\n\n  useEffect(() => {\n    execute({ isOpen: true, limit: 10 });\n  }, []);\n\n  if (loading) return <LoadingSpinner />;\n  if (error) return <ErrorDisplay error={error} onRetry={() => execute()} />;\n  \n  return (\n    <FlatList\n      data={data}\n      renderItem={({ item }) => <RestaurantCard restaurant={item} />}\n    />\n  );\n};\n```\n\n### Direct API Call\n\n```typescript\nimport { restaurantApi } from '@/src/services/customer/restaurant.service';\nimport { handleApiError } from '@/src/utils/errorHandler';\nimport Toast from 'react-native-toast-message';\n\nconst fetchRestaurants = async () => {\n  try {\n    const restaurants = await restaurantApi.getAllRestaurants({ isOpen: true });\n    return restaurants;\n  } catch (error) {\n    const apiError = handleApiError(error);\n    Toast.show({\n      type: 'error',\n      text1: 'Error',\n      text2: apiError.message,\n    });\n    throw error;\n  }\n};\n```\n\n### TanStack Query Integration\n\n```typescript\nimport { useQuery } from '@tanstack/react-query';\nimport { restaurantApi } from '@/src/services/customer/restaurant.service';\nimport { handleApiError } from '@/src/utils/errorHandler';\n\nconst useRestaurants = () => {\n  return useQuery({\n    queryKey: ['restaurants'],\n    queryFn: () => restaurantApi.getAllRestaurants({ isOpen: true }),\n    onError: (error) => {\n      const apiError = handleApiError(error);\n      Toast.show({\n        type: 'error',\n        text1: 'Error',\n        text2: apiError.message,\n      });\n    },\n  });\n};\n```\n\n## Error Handling\n\n### Automatic Error Messages\n\nThe system automatically provides user-friendly error messages:\n\n- **Network errors**: \"Network error. Please check your connection.\"\n- **Authentication errors**: \"Authentication failed. Please log in again.\"\n- **Server errors**: \"Server error occurred. Please try again later.\"\n- **Validation errors**: \"Please check your input and try again.\"\n\n### Multi-language Support\n\nError messages are automatically translated based on user's language:\n\n```typescript\n// English\n\"Authentication failed. Please log in again.\"\n\n// French\n\"Échec de l'authentification. Veuillez vous reconnecter.\"\n```\n\n### Development vs Production\n\n- **Development**: Shows detailed server error messages for debugging\n- **Production**: Shows generic, user-friendly messages to protect sensitive information\n\n## Configuration\n\n### Environment Variables\n\nSet your API URL in `.env`:\n\n```bash\nEXPO_PUBLIC_API_URL=http://localhost:3000/api\n# or for production:\nEXPO_PUBLIC_API_URL=https://your-api.com/api\n```\n\n### Android Emulator\n\nThe system automatically handles Android emulator localhost issues by converting `localhost` to `10.0.2.2`.\n\n## Best Practices\n\n### 1. Use the Hook for Components\n\n```typescript\n// ✅ Good - Uses hook with built-in error handling\nconst { data, loading, error, execute } = useApiCall(apiFunction);\n\n// ❌ Avoid - Manual error handling in every component\nconst [loading, setLoading] = useState(false);\nconst [error, setError] = useState(null);\n// ... manual try/catch logic\n```\n\n### 2. Use ErrorDisplay Component\n\n```typescript\n// ✅ Good - Consistent error UI\nif (error) return <ErrorDisplay error={error} onRetry={refetch} />;\n\n// ❌ Avoid - Custom error UI in every component\nif (error) return <Text style={{color: 'red'}}>{error.message}</Text>;\n```\n\n### 3. Let the System Handle Errors\n\n```typescript\n// ✅ Good - Let the system handle errors\ntry {\n  await apiCall();\n} catch (error) {\n  // Error is already logged and user is notified\n  // Just handle any component-specific logic\n}\n\n// ❌ Avoid - Manual error handling\ntry {\n  await apiCall();\n} catch (error) {\n  console.error(error);\n  Alert.alert('Error', error.message);\n  // Duplicates system error handling\n}\n```\n\n## Migration from Old System\n\n### Replace Complex Error Handling\n\n```typescript\n// Old complex way\nimport { errorUtils } from '@/src/utils/errorHandler';\nconst userMessage = errorUtils.getUserFriendlyErrorMessage(error);\n\n// New simple way\nimport { handleApiError } from '@/src/utils/errorHandler';\nconst apiError = handleApiError(error);\nconst userMessage = apiError.message;\n```\n\n### Use Simplified API Client\n\n```typescript\n// Old way with manual error handling\ntry {\n  const response = await apiClient.get('/restaurants');\n  return response.data;\n} catch (error) {\n  throw this.handleApiError(error);\n}\n\n// New way - errors handled automatically\nconst response = await apiClient.get('/restaurants');\nreturn response.data;\n```\n\n## Troubleshooting\n\n### Common Issues\n\n1. **Network Errors**: Check your API URL and network connection\n2. **Android Localhost**: Ensure you're using the correct IP (handled automatically)\n3. **Token Refresh**: System handles this automatically\n4. **Error Messages**: Check translation files for missing keys\n\n### Debug Mode\n\nIn development mode (`__DEV__ = true`):\n- Detailed error messages are shown\n- Errors are logged to console\n- Server error messages are displayed\n\nIn production mode:\n- Generic error messages are shown\n- Sensitive information is hidden\n- User-friendly messages are displayed\n"